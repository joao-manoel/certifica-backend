receivers:
  otlp:
    protocols:
      grpc:
        endpoint: 0.0.0.0:4317
      http:
        endpoint: 0.0.0.0:4318

processors:
  batch: {}

# Conector que converte TRACES -> METRICS (RED)
connectors:
  spanmetrics:
    histogram:
      explicit:
        buckets: [5ms, 10ms, 25ms, 50ms, 100ms, 250ms, 500ms, 1s, 2.5s, 5s]
    dimensions:
      - service.name
      - http.method
      - http.status_code
    metrics_namespace: traces_spanmetrics

exporters:
  # Traces para o Jaeger (gRPC 14250)
  jaeger:
    endpoint: jaeger:14250
    tls:
      insecure: true

  # Exposição de MÉTRICAS (Prometheus vai fazer scrape)
  prometheus:
    endpoint: 0.0.0.0:8889

  # (opcional) debug de traces/métricas no log do collector
  logging:
    loglevel: debug

extensions:
  health_check: {}

service:
  extensions: [health_check]
  pipelines:
    traces:
      receivers: [otlp]
      processors: [batch]
      exporters: [jaeger, logging]
    # Métricas saem do conector spanmetrics
    metrics:
      receivers: [spanmetrics]
      processors: [batch]
      exporters: [prometheus, logging]
